From 53f8189ca6e9db01a83681dea54a19551dd39c55 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E7=94=9F=E4=BA=8E=E7=94=9F=E6=97=B6=20=E4=BA=A1=E4=BA=8E?=
 =?UTF-8?q?=E4=BA=A1=E5=88=BB?=
 <127004703+Tools-cx-app@users.noreply.github.com>
Date: Sat, 13 Dec 2025 05:47:59 +0800
Subject: [PATCH 2/3] fix complete

Implement namespace switching for non-Linux platforms based on mount_master condition.
---
 userspace/ksud/src/su.rs | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/userspace/ksud/src/su.rs b/userspace/ksud/src/su.rs
index c430053..8fa3d4f 100644
--- a/userspace/ksud/src/su.rs
+++ b/userspace/ksud/src/su.rs
@@ -270,10 +270,17 @@ pub fn root_shell() -> Result<()> {
             #[cfg(any(target_os = "linux", target_os = "android"))]
             let global_namespace_enable = std::fs::read_to_string(defs::GLOBAL_NAMESPACE_FILE)
                 .unwrap_or_else(|_| "0".to_string());
+
+            #[cfg(any(target_os = "linux", target_os = "android"))]
             if global_namespace_enable.trim() == "1" || mount_master {
                 let _ = utils::switch_mnt_ns(1);
             }
 
+            #[cfg(not(any(target_os = "linux", target_os = "android")))]
+            if mount_master {
+                let _ = utils::switch_mnt_ns(1);
+            }
+
             if use_fd_wrapper {
                 wrap_tty(0);
                 wrap_tty(1);
-- 
2.51.0

